#!/usr/bin/env bash
# SPDX-License-Identifier: MIT
# Copyright (c) 2026 Alfred Jean LLC
set -euo pipefail

# Build and install quench to ~/.local/bin

INSTALL_DIR="${HOME}/.local/bin"
BINARY_NAME="quench"

# Build release binary
echo "Building release binary..."
cargo build --release

# Create install directory if needed
mkdir -p "${INSTALL_DIR}"

# Copy binary
echo "Installing to ${INSTALL_DIR}/${BINARY_NAME}..."
cp "target/release/${BINARY_NAME}" "${INSTALL_DIR}/${BINARY_NAME}"

# Re-sign on macOS (required for adhoc-signed binaries)
if [[ "$(uname)" == "Darwin" ]]; then
    echo "Re-signing binary for macOS..."
    codesign --force --sign - "${INSTALL_DIR}/${BINARY_NAME}"
fi

# Check if install dir is in PATH
if [[ ":${PATH}:" != *":${INSTALL_DIR}:"* ]]; then
    echo ""
    echo "Warning: ${INSTALL_DIR} is not in your PATH"
    echo "Add this to your shell profile:"
    echo "  export PATH=\"\${HOME}/.local/bin:\${PATH}\""
fi

echo "Done"
