# JavaScript / TypeScript Language Adapter Roadmap

This roadmap covers adding JavaScript/TypeScript language support to quench.
Phases use 49x numbering (after Go 45x-48x, before Agents 5xx).

## Dependencies from .0-outline

| This Phase | Blocked By | Reason |
|------------|------------|--------|
| 491 | Phase 201 | Requires adapter trait definition |
| 493 | Phase 201 | Requires adapter trait definition |
| 495 | Phase 205-220 | Requires escapes check framework |
| 496 | Phase 205-220 | Requires escapes check framework |
| 497 | Phase 705-720 | Requires tests check correlation |
| 498 | Phase 915 | Requires test runner framework |
| 499 | Phase 1005-1020 | Requires build check framework |
| 4991 | Phase 1505-1510 | Requires init command profile system |

---

## Phase 491: JavaScript Adapter - Specs

_Blocked by: Phase 201 (Generic Language Adapter)_

- [ ] Spec: auto-detected when package.json, tsconfig.json, or jsconfig.json present
- [ ] Spec: default source patterns **/*.js, **/*.ts, **/*.jsx, **/*.tsx, **/*.mjs, **/*.mts
- [ ] Spec: default test patterns **/*.test.*, **/*.spec.*, **/__tests__/**
- [ ] Spec: default ignores node_modules/, dist/, build/, .next/, coverage/
- [ ] Spec: detects package name from package.json
- [ ] Spec: detects workspaces from package.json or pnpm-workspace.yaml
- [ ] Spec: `as unknown` without // CAST: comment fails
- [ ] Spec: `@ts-ignore` forbidden in source code
- [ ] Spec: eslint-disable without comment fails (when configured)
- [ ] Spec: biome-ignore without explanation fails (when configured)
- [ ] Spec: lint config changes with source changes fails standalone policy

## Phase 493: JavaScript Adapter - Detection

_Blocked by: Phase 201 (Generic Language Adapter)_

- [ ] package.json detection
- [ ] tsconfig.json detection
- [ ] jsconfig.json detection
- [ ] Default source patterns (**/*.js, **/*.ts, **/*.jsx, **/*.tsx, **/*.mjs, **/*.mts)
- [ ] Default test patterns (**/*.test.*, **/*.spec.*, **/__tests__/**)
- [ ] Default ignore patterns (node_modules/, dist/, build/, .next/, coverage/)
- [ ] Package name extraction from package.json
- [ ] Workspace detection (npm/yarn/pnpm workspaces)
- [ ] Integration test: detect packages in fixtures/js-project

## Phase 494: JavaScript Test Fixture

_Blocked by: Phase 010 (Test Fixtures) - can run in parallel_

- [ ] fixtures/js-simple/ - small JS/TS project with package.json, src/, tests/
- [ ] fixtures/js-monorepo/ - multi-package workspace (npm/pnpm)
- [ ] Add JavaScript violations to fixtures/violations/
- [ ] Fixture README updates

## Phase 495: JavaScript Adapter - Escapes

_Blocked by: Phase 205-220 (Escapes Check)_

- [ ] Default `as unknown` pattern
- [ ] Default `@ts-ignore` pattern (forbid)
- [ ] CAST comment requirement for `as unknown`
- [ ] Test code exemption for escape patterns
- [ ] Unit tests for JavaScript escape patterns

## Phase 496: JavaScript Adapter - Suppress

_Blocked by: Phase 205-220 (Escapes Check)_

- [ ] eslint-disable-next-line detection
- [ ] eslint-disable block detection
- [ ] biome-ignore detection
- [ ] Suppress check levels (forbid/comment/allow)
- [ ] Custom comment pattern for suppress
- [ ] Per-rule allow list (no comment needed)
- [ ] Per-rule forbid list (never allowed)
- [ ] Separate source vs test suppress policies
- [ ] Unit tests for suppress parsing

## Phase 497: JavaScript Adapter - Policy

_Blocked by: Phase 325 (Rust Adapter - Policy) for pattern, Phase 705-720 for tests correlation_

- [ ] lint_changes = "standalone" enforcement
- [ ] Lint config file detection:
  - ESLint: .eslintrc, .eslintrc.js, .eslintrc.json, .eslintrc.yml, eslint.config.js, eslint.config.mjs
  - Biome: biome.json, biome.jsonc
- [ ] Mixed change detection (lint config + source in same branch)
- [ ] Standalone PR requirement violation

### Checkpoint: JavaScript Adapter Basic Complete
- [ ] `quench check` on fixtures/js-simple with no config produces useful output
- [ ] `quench check` on fixtures/js-monorepo detects all packages
- [ ] JavaScript-specific escapes detected in fixtures/violations
- [ ] Snapshot tests for JavaScript adapter output

---

## Phase 498: JavaScript Test Runners

_Blocked by: Phase 915 (Test Runners - Framework)_

### Vitest Runner
- [ ] vitest run --reporter=json execution
- [ ] JSON output parsing
- [ ] Per-test timing extraction
- [ ] Pass/fail status extraction
- [ ] Test count metrics

### Jest Runner
- [ ] jest --json execution
- [ ] JSON output parsing
- [ ] Per-test timing extraction
- [ ] Pass/fail status extraction
- [ ] Test count metrics

### Bun Runner
- [ ] bun test --reporter=json execution
- [ ] JSON output parsing
- [ ] Per-test timing extraction
- [ ] Pass/fail status extraction

### Runner Selection
- [ ] Auto-detect runner from package.json scripts
- [ ] Auto-detect runner from config files (vitest.config.ts, jest.config.js)
- [ ] Explicit runner configuration
- [ ] Integration test: run tests on fixtures/js-simple

## Phase 4981: JavaScript Test Runners - Coverage

_Blocked by: Phase 498 (JavaScript Test Runners)_

- [ ] Vitest coverage (v8/istanbul, built-in)
- [ ] Jest coverage (istanbul, built-in)
- [ ] Bun coverage (built-in)
- [ ] Coverage report parsing (lcov, json formats)
- [ ] Line coverage percentage extraction
- [ ] Per-file coverage data
- [ ] Coverage aggregation across packages

### Checkpoint: JavaScript Test Runner Complete
- [ ] `quench check --ci --tests` runs appropriate test runner on JS/TS projects
- [ ] Per-test timing extracted from JSON output
- [ ] Coverage metrics collected
- [ ] Snapshot tests for JavaScript test runner output

---

## Phase 499: JavaScript Build Metrics

_Blocked by: Phase 1005-1020 (Build Check)_

### Bundler Detection
- [ ] Vite detection (vite.config.ts, vite.config.js)
- [ ] Webpack detection (webpack.config.js, webpack.config.ts)
- [ ] esbuild detection (esbuild.config.js, package.json scripts)
- [ ] Rollup detection (rollup.config.js, rollup.config.ts)
- [ ] Next.js detection (next.config.js, next.config.mjs)
- [ ] Parcel detection (package.json)

### Bundle Size
- [ ] Build target detection from bundler config
- [ ] Explicit targets configuration
- [ ] Raw file size measurement
- [ ] Gzipped size measurement
- [ ] Source map exclusion from size calculation
- [ ] Per-target metrics

### Build Time
- [ ] Cold build execution (rm -rf dist && npm run build)
- [ ] Cold build timing
- [ ] Hot build execution (npm run build, bundler caching)
- [ ] Hot build timing

### Bundler-Specific Features
- [ ] Vite: Read chunk info from build manifest
- [ ] Webpack: Parse stats.json if available
- [ ] esbuild: Use metafile output

### Checkpoint: JavaScript Build Metrics Complete
- [ ] `quench check --ci --build` measures bundle size and build time
- [ ] Gzipped sizes reported alongside raw sizes
- [ ] Snapshot tests for JavaScript build output

---

## Phase 4991: JavaScript Profile Defaults

_Blocked by: Phase 1505-1510 (Init Command - Profile Detection/Config Generation)_

- [ ] JavaScript profile defaults struct (escapes, suppress, policy)
- [ ] Profile enum includes "javascript" / "js" / "typescript" / "ts"
- [ ] Auto-detection: package.json → javascript profile
- [ ] Auto-detection: tsconfig.json → javascript profile (TypeScript variant)
- [ ] JavaScript profile defaults application in init

## Phase 4993: JavaScript Landing the Plane

_Blocked by: Phase 1515 (Init Command - Landing the Plane)_

- [ ] JavaScript Landing the Plane checklist items:
  - `npm run lint` (or pnpm/yarn/bun equivalent)
  - `npm run typecheck` (if tsconfig.json exists)
  - `npm test`
  - `npm run build`
- [ ] Package manager detection (npm/pnpm/yarn/bun)
- [ ] Checklist merging with base items

### Checkpoint: JavaScript Init Complete
- [ ] `quench init` on fixtures/js-simple auto-detects javascript profile
- [ ] `quench init --profile javascript` creates JS/TS-specific config
- [ ] `quench init --profile javascript,claude` populates Landing the Plane with JS items

---

## Summary: Blocking Relationships

```
Phase 201 (Generic Adapter)
    ├── Phase 491 (JS Specs)
    └── Phase 493 (JS Detection)
            └── Phase 494 (JS Fixture) [parallel]

Phase 205-220 (Escapes Check)
    ├── Phase 495 (JS Escapes)
    └── Phase 496 (JS Suppress)

Phase 325 (Rust Policy) + Phase 705-720 (Tests Correlation)
    └── Phase 497 (JS Policy)

Phase 915 (Test Runner Framework)
    └── Phase 498 (JS Test Runners)
            └── Phase 4981 (JS Coverage)

Phase 1005-1020 (Build Check)
    └── Phase 499 (JS Build Metrics)

Phase 1505-1510 (Init Profile System)
    └── Phase 4991 (JS Profile Defaults)
            └── Phase 4993 (JS Landing the Plane)
```

## Parallel Execution Opportunities

These JavaScript phases can run in parallel with their non-Go/Rust counterparts:

| JS Phase | Can Parallel With |
|----------|-------------------|
| 491-493 | Phase 451-455 (Go Adapter), Phase 401-420 (Shell Adapter) |
| 494 | Any fixture work |
| 495-496 | Any escapes work after framework done |
| 498-4981 | Phase 475-477 (Go runners), Phase 920-930 (Cargo/Bats runners) |
| 499 | Phase 480 (Go build metrics), Phase 1010-1015 (Rust build metrics) |
| 4991-4993 | Phase 485-487 (Go profile), Phase 1510 (other profile defaults) |

## JavaScript-Specific Considerations

### Package Manager Detection

Detect and adapt to the project's package manager:

| Indicator | Package Manager |
|-----------|-----------------|
| `pnpm-lock.yaml` | pnpm |
| `yarn.lock` | yarn |
| `bun.lockb` | bun |
| `package-lock.json` | npm |
| (fallback) | npm |

### Monorepo Support

Support common monorepo patterns:

| Pattern | Detection |
|---------|-----------|
| npm workspaces | `workspaces` field in package.json |
| pnpm workspaces | pnpm-workspace.yaml |
| yarn workspaces | `workspaces` field in package.json |
| Turborepo | turbo.json |
| Nx | nx.json |
| Lerna | lerna.json |

### TypeScript vs JavaScript

The adapter handles both, with TypeScript-specific features when tsconfig.json is present:

- TypeScript escape patterns (`as unknown`, `@ts-ignore`) only apply to `.ts`/`.tsx` files
- Type checking step in Landing the Plane only when tsconfig.json exists
- Bundle analysis can distinguish between TS source and compiled output
